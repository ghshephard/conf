# I prefer Control-S my Tmux prefix Key - Leaves Ctr-A alone, and S is close to shift lock on home row.
unbind C-b
set-option -g prefix C-s

# I have vi in my DNA.  Following command ensures that copy-mode is all vi.
set-window-option -g mode-keys vi
set -g status-keys vi


# Nice to have a "Capture Screen" Key - use something simliar to OS X CMd-Shift-4 - option-4
bind-key -n M-4 capture-pane\; display-message "Captured b"

# Don't want to lose window history when we exit window.  option-x to kill the pane for real.
set -g remain-on-exit on
bind-key -n M-'x' kill-pane

# I use command-prompt a lot - make it easiy accsssible.
# unbind-key -n M-';'
bind-key -n M-'\;' command-prompt


# Want to give myself a few seconds before I enter the number for the pane.

set-option -g display-panes-time 10000

# Set the default terminal mode to 256color mode.  Makes coloring look better.
# Make sure that you set terminal type in iTerm to be xterm-256 as well.
set -g default-terminal "screen-256color"

# Make it obvious which is the active window in the status line - red stands out.
set-window-option -g window-status-current-bg red

# Tweak the border style of the Active pane to make it stand out.
setw -g pane-border-style fg=green,bg=black
setw -g pane-active-border-style fg=black,bg=yellow

# Make sure the active pane is highly visible (white on black is the default)
setw -g window-active-style fg=white,bg=black

# And make it obvious which ones are in the background.
setw -g window-style fg=green,bg=colour236




# Use the good old VI Keys to move between panes and resize Panes
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

bind -nr M-H resize-pane -L 5
bind -nr M-J resize-pane -D 5
bind -nr M-K resize-pane -U 5
bind -nr M-L resize-pane -R 5



# This is what lets us use pbcopy/pbpaste in OS X 10.8 (and others) - basically lets us talk to the parent clipboard.
# set-option -g default-command "reattach-to-user-namespace -l bash"
# set-option -g default-command bash
# setw -g monitor-activity on


# As of Tmux 2.1 - all mouse is enabled with "mouse" option.
# Experimenting with forcing myself to use keyboard by disabing mouse support.
set -g mouse off


# really, why not just Meta-[ for scroll back - any need for prefix?  I thought not.
bind-key -n M-[ copy-mode -e

# Set this to speed up commands to go into Scroll back, like Meta-[
set-option -g escape-time 100

#Hot Key to zoom / unzoom screen.
bind-key -n  M-'z' resize-pane -Z\; display-message "Rapid Zoom"

# Jump to window where activity is being monitored?
bind-key -n M-'n' next-window -a\; display-message "Last Action"

# o goes right, only seems reasonable that O goes Left
bind-key O select-pane -t :.-
bind-key -n M-'O' select-pane -t :.-
bind-key -n M-'o' select-pane -t :.+
unbind-key -n C-'['
unbind-key -n C-']'


# WHo *doesn't* want a big history.
# Admittedly, it does mean that gwnccd really slows down Resurrect Save, because there is so much crud.
# Honestly - Do I really need to run gwncccd in verbose background mode?  When was the last time I even looked at it...
set-option -g history-limit 60000


# Incremental search backwards.  When you get to what you want, hit Enter, and then the n or N key
# to jump back and forth between instances.
bind-key -T copy-mode-vi r command-prompt -i -p "search up" "send -X search-backward-incremental \"%%%\""



# When I hit enter - I want to copy into system buffer
# This behavior changed in 2.4 - the whole "mode-key-tables" thing went away (along with -t)
# So, now everything is in the copy-mode-vi Table.  Fair enough.
unbind-key -T copy-mode-vi  Enter

# Here, we are saying, "When you are in vi copy mode, and someone hits the enter key,
# Copy whatever is selected into the Clipboard with pbcopy command line utility.
# The real magic here is the "-X" flag which instructs send-keys that whats following is
# not actual keys, but a command.  Why they didn't create a "send-command" is beyond me...
# We use pbcopy with OS-X
# bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

# We use xclip with Linux
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -sel clip -i"


# while we are at it - let's tweak a couple VI copy commands.
# I want "a" to activate the "append without cancel"

bind-key -T copy-mode-vi a send-keys -X append-selection

# I want ' to do a copy-selection (replace the buffer) *without cancel* - good with a
bind-key -T copy-mode-vi "'" send-keys -X copy-selection

# My first multi-command, with %%% and command prompt
bind-key -T copy-mode-vi p command-prompt -p "Buffer" "send-keys -X copy-selection; set-buffer -n \"%%%\"; "

# Track Pad scroll mode - Switch to copy mode, or, alternatively, scroll up when mouse/trackpad up.
# Only relevant if the mouse support is being used.    See set -g mouse off/on
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"

# Okay, we are going all in on the keyboard here.  I like C-u as a good "Go Up" - but
# I hate having to go into scroll back modem with Prefix+[.
# Following checks to see if "alternate_on" is set, if so, (man page) then just send the u
# key to up half a page in the man page.  Otherwise, Switch to copy mode, and then send
# a commnand to copy-mode to go up half a page.  After this, the mode-copy-vi keys will
# be used, and *not* this command.

bind -n C-u  if-shell -Ft= "#{alternate_on}" "send u" "copy-mode -e; send -X halfpage-up;  "

# Following are mouse support commands for VI.  Only relevant if mouse support is enabled.
bind -n WheelDownPane select-pane -t= \; send-keys -M
bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M
bind -T copy-mode-vi WheelUpPane   send-keys -X halfpage-up
bind -T copy-mode WheelDownPane send-keys -X halfpage-down

# Needed this line to let iTerm do CMD-Key paste, or keys were ignored.
set -g assume-paste-time 0

# Handy shortcut to clear tmux buffer.
bind-key -n C-k clear-history

# Awesome new feature in tmux 23 - ability to display text in the pane borders.
# Super useful, as I want to know what the Pane Number is for pane move/copy commands.
# Also useful for getting a sense of how much is in the scroll back buffer.

set -g pane-border-format '#{pane_id} sc:[#{history_size}]'
set -g pane-border-status bottom

# set -g status-right '#{window_id}.#{pane_id} #{pane_tty}'
# bind-key H pipe-pane  'cat >>$HOME/tmux-#W.log' \; display-message 'logging to $HOME/tmux-#W.log'
# bind-key h pipe-pane \; display-message 'Ended logging to $HOME/tmux-#W.log'


# force a reload of the config file
 unbind r
 bind-key r source-file ~/.tmux.conf\; display-message "Source File ./tmux.conf Read!"

# TMUX PLUGIN MANAGER STUFF HERE
# List of plugins
# tmux-ressurrect is pretty awesome - allows me to save/restore all my pane contents.
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-save-interval '60'
set -g @resurrect-capture-pane-contents 'on'


# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

